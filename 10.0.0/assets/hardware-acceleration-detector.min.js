function checkPotentialHardwareAccelerationIssue(e){let r={issueDetected:!1,reason:"未知原因 (Unknown)",details:"",browserInfo:navigator.userAgent};try{const t=document.createElement("canvas"),n=t.getContext("webgl")||t.getContext("experimental-webgl");if(!n)return r.issueDetected=!0,r.reason="WebGL上下文创建失败 (WebGL context creation failed)",r.details="浏览器可能不支持WebGL，或者图形驱动存在问题。",void e(r);const o=n.getExtension("WEBGL_debug_renderer_info");if(o){const e=n.getParameter(o.UNMASKED_RENDERER_WEBGL),t=n.getParameter(o.UNMASKED_VENDOR_WEBGL);r.details=`WebGL Renderer: ${e}, Vendor: ${t}`;const a=["intel","nvidia","amd","radeon","geforce","iris","vmware","virgl","mali","adreno","apple","m1","m2","m3"],s=["swiftshader","llvmpipe","microsoft basic render driver","software rasterizer","software"];let i=!1,d="";if(e){d=e.toLowerCase();for(const e of s)if(d.includes(e)){i=!0,r.reason=`检测到软件渲染器: ${e} (Software renderer detected)`;break}if(!i){if(d.includes("angle"))if(d.includes("warp")||d.includes("pseudo-warp")||d.includes("d3d9"))i=!0,r.reason="检测到ANGLE软件渲染模式 (ANGLE software rendering mode detected)";else{let e=!1;for(const r of a)if(d.includes(r)){e=!0;break}e||(i=!0,r.reason="可能使用ANGLE软件渲染 (Possible ANGLE software rendering)")}if(d.includes("mesa")){let e=!1;for(const r of a)if(d.includes(r)){e=!0;break}e||(i=!0,r.reason="可能使用Mesa软件渲染 (Possible Mesa software rendering)")}}i&&(r.issueDetected=!0)}}else r.details="无法获取WEBGL_debug_renderer_info扩展 (Could not get WEBGL_debug_renderer_info extension)";if(!r.issueDetected){const e=performance.now(),t=document.createElement("canvas");t.width=200,t.height=200;const n=t.getContext("2d");if(n){for(let e=0;e<1e4;e++)n.fillRect(5*e%200,3*e%200,2,2);const t=performance.now()-e;r.details+=` | 2D Canvas测试耗时: ${t.toFixed(2)}ms`;let o=200;const a=navigator.userAgent.toLowerCase();a.includes("firefox")?o=300:a.includes("safari")&&!a.includes("chrome")?o=250:a.includes("edge")&&(o=220),t>o&&(r.issueDetected=!0,r.reason=`2D Canvas渲染较慢 (${t.toFixed(0)}ms > ${o}ms)`)}}}catch(e){r.issueDetected=!0,r.reason="检测过程中发生错误 (Error during detection)",r.details=e.message,console.error("硬件加速检测错误:",e)}e(r)}function showHardwareAccelerationPrompt(e){if(sessionStorage.getItem("hardwareAccelerationPromptShown"))return;const r=document.getElementById("hardware-accel-prompt");r&&r.remove();const t=document.createElement("div");t.id="hardware-accel-prompt",t.style.cssText="\n        position: fixed;\n        bottom: 20px;\n        left: 20px;\n        background-color: #ffffe0;\n        border: 1px solid #ccc;\n        padding: 15px;\n        border-radius: 5px;\n        box-shadow: 0 2px 10px rgba(0,0,0,0.2);\n        z-index: 1000000; /* 确保在最上层 */\n        font-family: sans-serif;\n        font-size: 14px;\n        max-width: 350px;\n        color: #333;\n    ",t.innerHTML=`\n        <p><strong>性能提示：</strong></p>\n        <p>为了获得最佳的浏览体验，建议您开启浏览器的硬件加速功能。</p>\n        <p>若已开启但仍感觉卡顿，可能是由于当前检测到：${e.reason}。</p>\n        <p><small>通常可以在浏览器设置的"系统"或"高级"选项中找到硬件加速设置。</small></p>\n        <div style="display: flex; justify-content: space-between; flex-wrap: wrap; gap: 5px; margin-top: 10px;">\n            <button id="close-hw-prompt" style="padding: 5px 10px; background: #f0f0f0; border: 1px solid #ccc; border-radius: 3px; cursor: pointer;">知道了</button>\n            <button id="dont-show-hw-prompt" style="padding: 5px 10px; background: #f0f0f0; border: 1px solid #ccc; border-radius: 3px; cursor: pointer;">不再显示</button>\n            <button id="recheck-hw-prompt" style="padding: 5px 10px; background: #f0f0f0; border: 1px solid #ccc; border-radius: 3px; cursor: pointer;">重新检测</button>\n        </div>\n        <details style="margin-top: 10px; font-size: 12px; color: #666;">\n            <summary>详细信息</summary>\n            <p style="word-break: break-word;">${e.details}</p>\n            <p>浏览器: ${e.browserInfo}</p>\n        </details>\n    `,document.body.appendChild(t),document.getElementById("close-hw-prompt").addEventListener("click",()=>{t.remove(),sessionStorage.setItem("hardwareAccelerationPromptShown","true")}),document.getElementById("dont-show-hw-prompt").addEventListener("click",()=>{t.remove(),localStorage.setItem("hardwareAccelerationPromptDisabled","true"),sessionStorage.setItem("hardwareAccelerationPromptShown","true")}),document.getElementById("recheck-hw-prompt").addEventListener("click",()=>{t.remove(),sessionStorage.removeItem("hardwareAccelerationPromptShown"),runHardwareAccelerationCheck()})}function runHardwareAccelerationCheck(){checkPotentialHardwareAccelerationIssue(e=>{console.log("硬件加速检测结果:",e),e.issueDetected&&showHardwareAccelerationPrompt(e)})}function initHardwareAccelerationCheck(){localStorage.getItem("hardwareAccelerationPromptDisabled")||(window.checkHardwareAcceleration=runHardwareAccelerationCheck,window.addEventListener("load",()=>{setTimeout(runHardwareAccelerationCheck,1e3)}))}initHardwareAccelerationCheck();