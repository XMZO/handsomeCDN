!function(){"use strict";const e={sources:Array.from({length:85},(e,t)=>`https://cdn.loli-con.cn/videos/background${t+1}.webm`),cacheIntervalMs:36e5,eggProbability:.01,mobileEggProbability:.005,eggImage:"https://cdn.loli-con.cn/imgs/H.webp",eggMessage:"🎉 恭喜发现彩蛋！🥵🥵🥵",specialVideos:[60,80,81].map(e=>`https://cdn.loli-con.cn/videos/background${e}.webm`),retry:{maxAttempts:20,baseDelayMs:1e3,maxDelayMs:3e4},injectCSS:!1,respectUserPreferences:!0,pauseOnHidden:!0,uiStyle:"original",autoUnmuteOnFirstClick:!0,showFirstUnmuteBanner:!0},t=navigator.userAgent||"",n=/Googlebot|Bingbot|Slurp|DuckDuckBot|Baiduspider|YandexBot|Sogou|Exabot|Chrome-Lighthouse|HeadlessChrome|PhantomJS|facebot|ia_archiver/i.test(t),o=window.matchMedia&&matchMedia("(pointer:coarse)").matches||/Mobi|Android|iPhone|iPad|iPod/i.test(t),a=e.respectUserPreferences&&window.matchMedia&&matchMedia("(prefers-reduced-motion: reduce)").matches,i=e.respectUserPreferences&&!(!navigator.connection||!navigator.connection.saveData);if(n||a||i)return void c(e.eggMessage,e.eggImage);if(o&&Math.random()<e.mobileEggProbability)return void c(e.eggMessage,e.eggImage);const r=function(){try{const t=localStorage.getItem("randomVideoData");if(!t)return"";const{video:n,time:o}=JSON.parse(t);return n&&o?Date.now()-o>e.cacheIntervalMs?"":n:""}catch(e){return""}}()||function(t,n){const o=Math.random()<e.eggProbability?"":t[Math.floor(Math.random()*t.length)];try{localStorage.setItem("randomVideoData",JSON.stringify({video:o,time:Date.now(),ttl:n}))}catch(e){}return o}(e.sources,e.cacheIntervalMs);if(!r)return void c(e.eggMessage,e.eggImage);e.injectCSS&&function(){try{const e="\n          #DynamicWallpaper{\n            position:fixed;\n            inset:0;\n            min-width:100vw;\n            min-height:100vh;\n            object-fit:cover;\n            z-index:-1;\n            pointer-events:none;\n          }",t=document.createElement("style");t.textContent=e,document.head.appendChild(t)}catch(e){}}();try{const e=document.createElement("link");e.rel="preload",e.as="video",e.href=r,e.type="video/webm",document.head.appendChild(e)}catch(e){}const s=document.createElement("video");s.id="DynamicWallpaper",s.src=r,s.autoplay=!0,s.muted=!0,s.loop=!0,s.preload="auto",s.playsInline=!0,s.setAttribute("aria-hidden","true"),s.disablePictureInPicture=!0,d(s),function(e,t){let n=0;e.addEventListener("error",()=>{if(n+=1,n>t.maxAttempts)return void console.warn("[video-bg] 加载失败次数过多，停止重试。");const o=Math.min(t.maxDelayMs,t.baseDelayMs*Math.pow(2,n-1));console.warn(`[video-bg] 加载错误，${o}ms 后重试（第 ${n}/${t.maxAttempts} 次）…`),setTimeout(()=>{d(e)},o)})}(s,e.retry),e.pauseOnHidden&&document.addEventListener("visibilitychange",()=>{if(document.hidden)try{s.pause()}catch(e){}else try{s.play()}catch(e){}});function d(e){try{e.load()}catch(e){}try{e.play()}catch(e){}}function c(e,t){const n=document.createElement("div");n.style.textAlign="center",n.style.marginTop="20%";const o=document.createElement("p");o.textContent=e;const a=document.createElement("img");a.src=t,a.alt="彩蛋图片",n.appendChild(o),n.appendChild(a),document.body.appendChild(n)}document.addEventListener("click",e=>{s.isConnected&&s.paused&&s.play().catch(()=>{})},{passive:!0}),e.specialVideos.includes(r)&&function(t){let n=!0,o=!1;function a(){if(!e.showFirstUnmuteBanner||!n)return;const t=document.createElement("div");t.textContent="😮发现特殊动态背景，已开启声音！",t.style.cssText=["position:fixed","bottom:80px","right:20px","background:linear-gradient(135deg, rgba(255,0,0,0.2), rgba(0,255,0,0.2), rgba(0,0,255,0.2))","backdrop-filter:blur(10px)","color:#FF69B4","padding:8px 16px","border-radius:8px","z-index:9999","font-size:12px","box-shadow:0 4px 15px rgba(0,0,0,0.2)","border:1px solid rgba(255,255,255,0.2)"].join(";"),document.body.appendChild(t),setTimeout(()=>t.remove(),3e3)}function i(e){e&&e.stopPropagation(),t.muted=!t.muted,r.textContent=t.muted?"🔇":"🔊",r.setAttribute("aria-pressed",String(!t.muted)),t.muted||(n=!1,t.play().catch(()=>{}),a())}const r=document.createElement("button");if(r.type="button",r.id="DynamicWallpaperUnmute",r.setAttribute("aria-pressed","false"),r.setAttribute("aria-label","切换背景视频静音状态"),r.textContent=t.muted?"🔇":"🔊","original"===e.uiStyle){let e;r.style.cssText=["position:fixed","bottom:20px","right:120px","background:rgba(255,255,255,0.3)","backdrop-filter:blur(10px)","color:black","border:none","padding:8px 12px","border-radius:50%","cursor:pointer","z-index:9999","font-size:14px","box-shadow:0 2px 10px rgba(0,0,0,0.1)","transition:opacity .3s ease","opacity:0.9"].join(";"),r.addEventListener("mouseenter",()=>{clearTimeout(e),r.style.opacity="1"}),r.addEventListener("mouseleave",()=>{e=setTimeout(()=>{r.style.opacity="0"},3e3)})}else r.style.position="fixed",r.style.bottom="20px",r.style.right="20px",r.style.background="rgba(0,0,0,0.5)",r.style.color="#fff",r.style.border="1px solid rgba(255,255,255,0.3)",r.style.borderRadius="8px",r.style.padding="8px 10px",r.style.fontSize="14px",r.style.cursor="pointer",r.style.zIndex="9999",r.style.backdropFilter="blur(4px)",r.style.transition="opacity .3s ease",r.style.opacity="0.9",r.addEventListener("mouseenter",()=>{r.style.opacity="1"}),r.addEventListener("mouseleave",()=>{r.style.opacity="0.9"});r.addEventListener("click",i),e.autoUnmuteOnFirstClick&&document.addEventListener("click",()=>{t.muted&&!o&&(o=!0,i())},{passive:!0});document.body.appendChild(r)}(s),document.body.appendChild(s)}();