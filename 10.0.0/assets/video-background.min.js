!function(){"use strict";const e={sources:Array.from({length:85},(e,t)=>`https://cdn.loli-con.cn/videos/background${t+1}.webm`),cacheIntervalMs:36e5,eggProbability:.01,mobileEggProbability:.005,eggImage:"https://cdn.loli-con.cn/imgs/H.webp",eggMessage:"ğŸ‰ æ­å–œå‘ç°å½©è›‹ï¼ğŸ¥µğŸ¥µğŸ¥µ",specialVideos:[60,80,81].map(e=>`https://cdn.loli-con.cn/videos/background${e}.webm`),retry:{maxAttempts:20,baseDelayMs:1e3,maxDelayMs:3e4},injectCSS:!1,respectUserPreferences:!0,pauseOnHidden:!0,uiStyle:"original",autoUnmuteOnFirstClick:!0,showFirstUnmuteBanner:!0},t=navigator.userAgent||"",n=/Googlebot|Bingbot|Slurp|DuckDuckBot|Baiduspider|YandexBot|Sogou|Exabot|Chrome-Lighthouse|HeadlessChrome|PhantomJS|facebot|ia_archiver/i.test(t),o=window.matchMedia&&matchMedia("(pointer:coarse)").matches||/Mobi|Android|iPhone|iPad|iPod/i.test(t),i=e.respectUserPreferences&&window.matchMedia&&matchMedia("(prefers-reduced-motion: reduce)").matches,r=e.respectUserPreferences&&!(!navigator.connection||!navigator.connection.saveData);if(n)return void console.info("[video-bg] æ£€æµ‹åˆ°çˆ¬è™«ï¼Œè·³è¿‡åŠ è½½");if(i||r)return void l(e.eggMessage,e.eggImage);if(o)return void(Math.random()<e.mobileEggProbability&&l(e.eggMessage,e.eggImage));const a=function(){try{const t=localStorage.getItem("randomVideoData");if(!t)return null;const n=JSON.parse(t);if("object"!=typeof n||null===n)throw new Error("Invalid data");const{video:o,time:i}=n;if("string"!=typeof o||!o)throw new Error("Invalid video");if(!function(e){if("string"!=typeof e)return!1;const t=/^https:\/\/cdn\.loli-con\.cn\/videos\/background(\d{1,3})\.webm$/,n=e.match(t);if(!n)return!1;const o=parseInt(n[1],10);return!(o<1||o>85)&&(!/[\x00-\x1F\x7F-\x9F\uFFFD]/.test(e)&&!(e.length>500))}(o))throw new Error("Invalid URL format");if("number"!=typeof i||i<=0)throw new Error("Invalid time");if(i-Date.now()>2592e6)throw new Error("Clock skew too large");return Date.now()-i>e.cacheIntervalMs?null:o}catch(e){console.warn("[video-bg] ç¼“å­˜å¼‚å¸¸ï¼Œå·²æ¸…ç†:",e.message);try{localStorage.removeItem("randomVideoData")}catch(e){}return null}}(),s=null!==a?a:function(t,n){const o=Math.random()<e.eggProbability?"":t[Math.floor(Math.random()*t.length)];if(o)try{localStorage.setItem("randomVideoData",JSON.stringify({video:o,time:Date.now(),ttl:n}))}catch(e){console.warn("[video-bg] ç¼“å­˜å¤±è´¥:",e.message)}return o}(e.sources,e.cacheIntervalMs);if(!s)return void l(e.eggMessage,e.eggImage);e.injectCSS&&function(){try{const e="\n        #DynamicWallpaper{\n          position:fixed;\n          inset:0;\n          min-width:100vw;\n          min-height:100vh;\n          object-fit:cover;\n          z-index:-1;\n          pointer-events:none;\n        }",t=document.createElement("style");t.textContent=e,document.head.appendChild(t)}catch(e){}}();try{const e=document.createElement("link");e.rel="preload",e.as="video",e.href=s,e.type="video/webm",document.head.appendChild(e)}catch(e){}const d=document.createElement("video");function c(e){try{e.load()}catch(e){}try{e.play()}catch(e){}}function l(e,t){const n=document.createElement("div");n.style.textAlign="center",n.style.marginTop="20%";const o=document.createElement("p");o.textContent=e;const i=document.createElement("img");i.src=t,i.alt="å½©è›‹å›¾ç‰‡",n.appendChild(o),n.appendChild(i),document.body.appendChild(n)}d.id="DynamicWallpaper",d.src=s,d.autoplay=!0,d.muted=!0,d.loop=!0,d.preload="auto",d.playsInline=!0,d.setAttribute("aria-hidden","true"),d.disablePictureInPicture=!0,c(d),function(e,t){let n=0;e.addEventListener("error",()=>{if(n+=1,n>t.maxAttempts)return console.warn("[video-bg] åŠ è½½å¤±è´¥æ¬¡æ•°è¿‡å¤šï¼Œæ”¾å¼ƒåŠ è½½"),void e.remove();const o=Math.min(t.maxDelayMs,t.baseDelayMs*Math.pow(2,n-1));console.warn(`[video-bg] åŠ è½½é”™è¯¯ï¼Œ${o}ms åé‡è¯•ï¼ˆç¬¬ ${n}/${t.maxAttempts} æ¬¡ï¼‰â€¦`),setTimeout(()=>{c(e)},o)})}(d,e.retry),e.pauseOnHidden&&document.addEventListener("visibilitychange",()=>{if(document.hidden)try{d.pause()}catch(e){}else try{d.play()}catch(e){}}),document.addEventListener("click",()=>{d.isConnected&&d.paused&&d.play().catch(()=>{})},{passive:!0}),e.specialVideos.includes(s)&&function(t){let n=!0,o=!1;function i(){if(!e.showFirstUnmuteBanner||!n)return;const t=document.createElement("div");t.textContent="ğŸ˜®å‘ç°ç‰¹æ®ŠåŠ¨æ€èƒŒæ™¯ï¼Œå·²å¼€å¯å£°éŸ³ï¼",t.style.cssText=["position:fixed","bottom:80px","right:20px","background:linear-gradient(135deg, rgba(255,0,0,0.2), rgba(0,255,0,0.2), rgba(0,0,255,0.2))","backdrop-filter:blur(10px)","color:#FF69B4","padding:8px 16px","border-radius:8px","z-index:9999","font-size:12px","box-shadow:0 4px 15px rgba(0,0,0,0.2)","border:1px solid rgba(255,255,255,0.2)"].join(";"),document.body.appendChild(t),setTimeout(()=>t.remove(),3e3)}function r(e){e&&e.stopPropagation(),t.muted=!t.muted,a.textContent=t.muted?"ğŸ”‡":"ğŸ”Š",a.setAttribute("aria-pressed",String(!t.muted)),t.muted||(n=!1,t.play().catch(()=>{}),i())}const a=document.createElement("button");if(a.type="button",a.id="DynamicWallpaperUnmute",a.setAttribute("aria-pressed","false"),a.setAttribute("aria-label","åˆ‡æ¢èƒŒæ™¯è§†é¢‘é™éŸ³çŠ¶æ€"),a.textContent=t.muted?"ğŸ”‡":"ğŸ”Š","original"===e.uiStyle){let e;a.style.cssText=["position:fixed","bottom:20px","right:120px","background:rgba(255,255,255,0.3)","backdrop-filter:blur(10px)","color:black","border:none","padding:8px 12px","border-radius:50%","cursor:pointer","z-index:9999","font-size:14px","box-shadow:0 2px 10px rgba(0,0,0,0.1)","transition:opacity .3s ease","opacity:0.9"].join(";"),a.addEventListener("mouseenter",()=>{clearTimeout(e),a.style.opacity="1"}),a.addEventListener("mouseleave",()=>{e=setTimeout(()=>{a.style.opacity="0"},3e3)})}else a.style.position="fixed",a.style.bottom="20px",a.style.right="20px",a.style.background="rgba(0,0,0,0.5)",a.style.color="#fff",a.style.border="1px solid rgba(255,255,255,0.3)",a.style.borderRadius="8px",a.style.padding="8px 10px",a.style.fontSize="14px",a.style.cursor="pointer",a.style.zIndex="9999",a.style.backdropFilter="blur(4px)",a.style.transition="opacity .3s ease",a.style.opacity="0.9",a.addEventListener("mouseenter",()=>{a.style.opacity="1"}),a.addEventListener("mouseleave",()=>{a.style.opacity="0.9"});a.addEventListener("click",r),e.autoUnmuteOnFirstClick&&document.addEventListener("click",()=>{t.muted&&!o&&(o=!0,r())},{passive:!0});document.body.appendChild(a)}(d),document.body.appendChild(d)}();