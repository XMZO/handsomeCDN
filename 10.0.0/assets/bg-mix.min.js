!function(){"use strict";const t="https://cdn.loli-con.cn/imgs/bg-manifest.json",n="https://cdn.loli-con.cn/imgs/",e=0,o="#6A6B6F",r=400,i="(max-width: 767px)";function a(t){document.querySelectorAll("[data-bg-mix-layer]").forEach(t=>t.remove());const n=document.createElement("div");n.setAttribute("data-bg-mix-layer","1"),n.style.cssText=`\n      position:fixed;inset:0;z-index:-1;pointer-events:none;\n      background:url(${JSON.stringify(t)}) center center no-repeat fixed ${o};\n      background-size:cover;opacity:0;\n      transition:opacity ${r}ms ease;\n    `,document.body.appendChild(n),requestAnimationFrame(()=>{n.style.opacity="1"})}async function c(){const o=function(){try{const t=localStorage.getItem("bgMixData");if(!t)return null;const n=JSON.parse(t);return!n||!n.url||Date.now()-n.time>e?null:n.url}catch{return null}}();if(o)return void a(o);const r=await async function(){try{const e=await fetch(t);if(!e.ok)return[];const o=await e.json();return Array.isArray(o)?o.map(t=>t.startsWith("http")?t:n+t):[]}catch{return console.warn("[bg-mix] manifest 加载失败"),[]}}();if(!r.length)return void console.warn("[bg-mix] manifest 为空，无法设置背景");const c=window.matchMedia(i).matches,s=r.filter(t=>c?t.includes("/mobile/"):t.includes("/pc/"));s.length||console.warn("[bg-mix] 没有匹配当前设备的背景，使用所有图片随机");const l=s.length?s:r;let u=l[Math.floor(Math.random()*l.length)];try{await function(t){return new Promise((n,e)=>{const o=new Image;o.referrerPolicy="strict-origin-when-cross-origin",o.onload=()=>n(t),o.onerror=e,o.src=t})}(u)}catch(t){console.warn("[bg-mix] 加载失败，尝试用第一张:",t),u=l[0]}a(u),function(t){try{localStorage.setItem("bgMixData",JSON.stringify({url:t,time:Date.now()}))}catch{}}(u)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",c,{once:!0}):c()}();